(function(t,e){"object"===typeof exports&&"object"===typeof module?module.exports=e():"function"===typeof define&&define.amd?define([],e):"object"===typeof exports?exports["canvas-scale"]=e():t["canvas-scale"]=e()})("undefined"!==typeof self?self:this,(function(){return function(t){var e={};function i(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(n,o,function(e){return t[e]}.bind(null,o));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s="fb15")}({f6fd:function(t,e){(function(t){var e="currentScript",i=t.getElementsByTagName("script");e in t||Object.defineProperty(t,e,{get:function(){try{throw new Error}catch(n){var t,e=(/.*at [^\(]*\((.*):.+:.+\)$/gi.exec(n.stack)||[!1])[1];for(t in i)if(i[t].src==e||"interactive"==i[t].readyState)return i[t];return null}}})})(document)},fb15:function(t,e,i){"use strict";var n;(i.r(e),"undefined"!==typeof window)&&(i("f6fd"),(n=window.document.currentScript)&&(n=n.src.match(/(.+\/)[^/]+\.js(\?.*)?$/))&&(i.p=n[1]));const o={height:50,start:1e3,end:1e4,unit:10,capacity:100,background:"#fff",midLineColor:"#087af7",scaleLineColor:"#999",openUnitChange:!0,sign:"@nowThen",fontColor:"#68ca68",fontSize:"16px SimSun, Songti SC"},r=window.devicePixelRatio,a=function(t,e,i,n){return i*((t=t/n-1)*t*t+1)+e};function c(t,e,i){this._id=`scale-${Math.random().toString(36).substring(2,9).toUpperCase()}`,this._container=t,this._config=Object.assign(o,e),this._callBack=i,this._canvas=document.createElement("canvas"),this._ctx=this._canvas.getContext("2d"),this._canvas._id=this._id,this._container.appendChild(this._canvas),this._canvas_bg=null,this._ctx_bg=null,this.current_def=0,this._ifError=!1}function s(t,e,i){const n=document.querySelector(t);if(!n)throw new Error("【scale】传入的「el」参数必须是有效的HTML容器节点！");"function"!==typeof i&&console.warn("【scale】传入的「callBack」参数不是有效的回调函数！");const o=new c(n,e,i);return o.$_init(),o}c.prototype.constructor=c,c.prototype.$_init=function(t){const{_config:e,_container:i,_canvas:n,_ctx:o}=this;this._ifError=!1,t&&(e=Object.assign(e,t)),e.height=Number(e.height),e.start=Number(e.start),e.end=Number(e.end),e.unit=Number(e.unit),e.capacity=Number(e.capacity),isNaN(e.height)&&(this._ifError=!0,console.error("【scale】传入的「options:height」参数必须是有效数字")),isNaN(e.start)&&(this._ifError=!0,console.error("【scale】传入的「options:start」参数必须是有效数字")),isNaN(e.end)&&(this._ifError=!0,console.error("【scale】传入的「options:end」参数必须是有效数字")),isNaN(e.unit)&&(this._ifError=!0,console.error("【scale】传入的「options:unit」参数必须是有效数字")),isNaN(e.capacity)&&(this._ifError=!0,console.error("【scale】传入的「options:capacity」参数必须是有效数字")),e.start>e.end&&(this._ifError=!0,console.error("【scale】传入的「options:end」参数值不能小于「options:end」参数值")),e.def?e.def<e.start?this.current_def=e.start-e.capacity:e.def>e.end&&(this.current_def=e.end+e.capacity):this.current_def=Math.floor(((e.end-e.start)/2+e.start)/e.capacity)*e.capacity;const{width:a}=i.getBoundingClientRect();if(e.width=Math.floor(a),e.height=Math.floor(e.height),n.style.width=`${e.width}px`,n.style.height=`${e.height}px`,n.width=r*e.width,n.height=r*e.height,o.scale(r,r),this._ifError)return o.beginPath(),o.font="12px Arial",o.fillStyle="red",o.textAlign="center",o.fillText("传入参数有误，渲染异常...",e.width/2,e.height/2),o.closePath(),void(o.fillStyle="transparent");this.$_drawScale(),this.$_drawSign(),this.$_drawMidLine(),this.$_addEvent()},c.prototype.$_drawScale=function(){const{_config:t,_ctx:e}=this,i=this._canvas_bg=document.createElement("canvas"),n=this._ctx_bg=i.getContext("2d");i.width=t.width*r,i.height=t.height*r,n.scale(r,r),console.log(this.current_def);let o=this.current_def-t.width/2*(t.capacity/t.unit),a=0,c=0;const s=Math.ceil((t.width+1)/t.unit),h=Math.ceil((t.end-t.start+1)/t.capacity);n.fillStyle=t.background||"transparent",n.fillRect(0,0,t.width,t.height),n.closePath(),n.beginPath(),n.moveTo(0,t.height),n.lineTo(t.width,t.height),n.strokeStyle=t.scaleLineColor||"#9E9E9E",n.lineWidth=1,n.stroke(),n.closePath();let l=Math.ceil(o/t.capacity)*t.capacity-o,d=l*(t.unit/t.capacity);for(let r=0;r<s;r++)if(c=(Math.ceil(o/t.capacity)+r)*t.capacity,!(c<t.start)){if(c>t.end)break;n.beginPath(),n.strokeStyle=t.scaleLineColor||"#9E9E9E",n.font=t.fontSize,n.fillStyle=t.fontColor,n.textAlign="center",n.shadowBlur=0,a=d+r*t.unit,c%(10*t.capacity)===0?(n.moveTo(a,1*t.height/2),n.strokeStyle=t.scaleLineColor||"#666",n.shadowColor="#9e9e9e",n.shadowBlur=1,n.fillText(c,a,1*t.height/3)):c%(5*t.capacity)===0?(n.moveTo(a,2*t.height/3),n.strokeStyle=t.scaleLineColor||"#888",h<=10&&(n.font="12px Helvetica, Tahoma, Arial",n.fillText(c,a,1*t.height/2))):n.moveTo(a,4*t.height/5),n.lineTo(a,t.height),n.stroke(),n.closePath()}e.drawImage(i,0,0,t.width*r,t.height*r,0,0,t.width,t.height)},c.prototype.$_drawMidLine=function(){const{_config:t,_ctx:e}=this,i=Math.floor(t.width/2);e.beginPath(),e.fillStyle=t.midLineColor||"#087af7",e.fillRect(i-1,0,2,t.height),e.stroke(),e.moveTo(i,8),e.lineTo(i-5,2),e.lineTo(i-5,0),e.lineTo(i+5,0),e.lineTo(i+5,2),e.fill(),e.moveTo(i,t.height-8),e.lineTo(i-5,t.height-2),e.lineTo(i-5,t.height),e.lineTo(i+5,t.height),e.lineTo(i+5,t.height-2),e.fill(),e.closePath()},c.prototype.$_drawSign=function(){const{_ctx:t,_config:e}=this;if(e.background){t.beginPath();const i=t.createLinearGradient(0,0,e.width,0);i.addColorStop(0,"rgba(255, 255, 255, 0.95)"),i.addColorStop(.45,"rgba(255, 255, 255, 0)"),i.addColorStop(.55,"rgba(255, 255, 255, 0)"),i.addColorStop(1,"rgba(255, 255, 255, 0.95)"),t.fillStyle=i,t.fillRect(0,0,e.width,e.height),t.closePath()}if(e.sign){t.beginPath(),t.font="10px Arial";const i=t.createLinearGradient(e.width,0,e.width-50,0);i.addColorStop(0,"rgba(255, 0, 0, 0.3)"),i.addColorStop(1,"rgba(0, 128, 0, 0.3)"),t.fillStyle=i,t.textAlign="right",t.fillText(e.sign,e.width-10,10),t.closePath(),t.fillStyle="transparent"}},c.prototype.$_addEvent=function(){let{_canvas:t,_config:e,$_moveDraw:i}=this,n=0,o=0,r=!1,c=0,s=0,h=0;const l=t=>{t.stopPropagation(),t.preventDefault(),r=!0,o=n=t.touches?t.touches[0].pageX:t.pageX,h=o,s=t.timeStamp||Date.now()},d=t=>{t.stopPropagation(),t.preventDefault();const n=t.touches?t.touches[0].pageX:t.pageX;if(r){const r=n-o;this.current_def=this.current_def-r*(e.capacity/e.unit),window.requestAnimationFrame(i.bind(this)),o=n;const a=t.timeStamp||Date.now();a-s>300&&(s=a,h=o)}},f=t=>{const i=t.changedTouches?t.changedTouches[0].pageX:t.pageX,n=t.timeStamp||Date.now(),o=-(i-h)/(n-s),l=()=>{this.current_def=a(d,c,e.capacity*o*50,f),this.current_def<e.start?this.current_def=e.start:this.current_def>e.end&&(this.current_def=e.end),e.openUnitChange&&(this.current_def=Math.round(this.current_def/e.capacity)*e.capacity),this.$_moveDraw(),d++,d<=f&&window.requestAnimationFrame(l)};r=!1;let d=0,f=15;Math.abs(o)>=.3?(c=this.current_def,l()):(this.current_def<e.start?this.current_def=e.start:this.current_def>e.end&&(this.current_def=e.end),e.openUnitChange&&(this.current_def=Math.round(this.current_def/e.capacity)*e.capacity),this.$_moveDraw())},u="ontouchstart"in window,p=u?"touchstart":"mousedown",g=u?"touchmove":"mousemove",_=u?"touchend":"mouseup";t.addEventListener(p,l),t.addEventListener(g,d),t.addEventListener(_,f)},c.prototype.$_moveDraw=function(){const{_ctx:t,_config:e}=this;if(t.clearRect(0,0,e.width,e.height),this.$_drawScale(),this.$_drawMidLine(),this.$_drawSign(),"function"!==typeof this._callBack)throw new Error("scale函数的第二个参数，必须为正确的回调函数！");this._callBack(Math.round(this.current_def))},c.prototype.update=function(t){this._point_x=(t-this._config.start)/this._config.capacity*this._config.unit,this.$_moveDraw()},c.prototype.resize=function(t){this.$_init(t)},c.prototype.clear=function(t){this._container&&this._canvas&&(this._container.removeChild(this._canvas),this._container=null,this._canvas=null)};var h={init:s};e["default"]=h}})["default"]}));
//# sourceMappingURL=canvas-scale.umd.min.js.map